61796c4331a08b2e6b2fd8a1664313fb
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var ErrorUtils=require('ErrorUtils');var Systrace=require('Systrace');var deepFreezeAndThrowOnMutationInDev=require('deepFreezeAndThrowOnMutationInDev');var invariant=require('fbjs/lib/invariant');var stringifySafe=require('stringifySafe');var TO_JS=0;var TO_NATIVE=1;var MODULE_IDS=0;var METHOD_IDS=1;var PARAMS=2;var MIN_TIME_BETWEEN_FLUSHES_MS=5;var TRACE_TAG_REACT_APPS=1<<17;var DEBUG_INFO_LIMIT=32;var JSTimers=null;var MessageQueue=function(){function MessageQueue(){_classCallCheck(this,MessageQueue);this._lazyCallableModules={};this._queue=[[],[],[],0];this._successCallbacks=[];this._failureCallbacks=[];this._callID=0;this._lastFlush=0;this._eventLoopStartTime=new Date().getTime();if(__DEV__){this._debugInfo={};this._remoteModuleTable={};this._remoteMethodTable={};}this.callFunctionReturnFlushedQueue=this.callFunctionReturnFlushedQueue.bind(this);this.callFunctionReturnResultAndFlushedQueue=this.callFunctionReturnResultAndFlushedQueue.bind(this);this.flushedQueue=this.flushedQueue.bind(this);this.invokeCallbackAndReturnFlushedQueue=this.invokeCallbackAndReturnFlushedQueue.bind(this);}_createClass(MessageQueue,[{key:'callFunctionReturnFlushedQueue',value:function callFunctionReturnFlushedQueue(module,method,args){var _this=this;this.__guard(function(){_this.__callFunction(module,method,args);});return this.flushedQueue();}},{key:'callFunctionReturnResultAndFlushedQueue',value:function callFunctionReturnResultAndFlushedQueue(module,method,args){var _this2=this;var result=void 0;this.__guard(function(){result=_this2.__callFunction(module,method,args);});return[result,this.flushedQueue()];}},{key:'invokeCallbackAndReturnFlushedQueue',value:function invokeCallbackAndReturnFlushedQueue(cbID,args){var _this3=this;this.__guard(function(){_this3.__invokeCallback(cbID,args);});return this.flushedQueue();}},{key:'flushedQueue',value:function flushedQueue(){var _this4=this;this.__guard(function(){_this4.__callImmediates();});var queue=this._queue;this._queue=[[],[],[],this._callID];return queue[0].length?queue:null;}},{key:'getEventLoopRunningTime',value:function getEventLoopRunningTime(){return new Date().getTime()-this._eventLoopStartTime;}},{key:'registerCallableModule',value:function registerCallableModule(name,module){this._lazyCallableModules[name]=function(){return module;};}},{key:'registerLazyCallableModule',value:function registerLazyCallableModule(name,factory){var module=void 0;var getValue=factory;this._lazyCallableModules[name]=function(){if(getValue){module=getValue();getValue=null;}return module;};}},{key:'getCallableModule',value:function getCallableModule(name){var getValue=this._lazyCallableModules[name];return getValue?getValue():null;}},{key:'enqueueNativeCall',value:function enqueueNativeCall(moduleID,methodID,params,onFail,onSucc){if(onFail||onSucc){if(__DEV__){this._debugInfo[this._callID]=[moduleID,methodID];if(this._callID>DEBUG_INFO_LIMIT){delete this._debugInfo[this._callID-DEBUG_INFO_LIMIT];}}onFail&&params.push(this._callID<<1);onSucc&&params.push(this._callID<<1|1);this._successCallbacks[this._callID]=onSucc;this._failureCallbacks[this._callID]=onFail;}if(__DEV__){global.nativeTraceBeginAsyncFlow&&global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS,'native',this._callID);}this._callID++;this._queue[MODULE_IDS].push(moduleID);this._queue[METHOD_IDS].push(methodID);if(__DEV__){JSON.stringify(params);deepFreezeAndThrowOnMutationInDev(params);}this._queue[PARAMS].push(params);var now=new Date().getTime();if(global.nativeFlushQueueImmediate&&(now-this._lastFlush>=MIN_TIME_BETWEEN_FLUSHES_MS||this._inCall===0)){var queue=this._queue;this._queue=[[],[],[],this._callID];this._lastFlush=now;global.nativeFlushQueueImmediate(queue);}Systrace.counterEvent('pending_js_to_native_queue',this._queue[0].length);if(__DEV__&&this.__spy&&isFinite(moduleID)){this.__spy({type:TO_NATIVE,module:this._remoteModuleTable[moduleID],method:this._remoteMethodTable[moduleID][methodID],args:params});}else if(this.__spy){this.__spy({type:TO_NATIVE,module:moduleID+'',method:methodID,args:params});}}},{key:'createDebugLookup',value:function createDebugLookup(moduleID,name,methods){if(__DEV__){this._remoteModuleTable[moduleID]=name;this._remoteMethodTable[moduleID]=methods;}}},{key:'__guard',value:function __guard(fn){this._inCall++;try{fn();}catch(error){ErrorUtils.reportFatalError(error);}finally{this._inCall--;}}},{key:'__callImmediates',value:function __callImmediates(){Systrace.beginEvent('JSTimers.callImmediates()');if(!JSTimers){JSTimers=require('JSTimers');}JSTimers.callImmediates();Systrace.endEvent();}},{key:'__callFunction',value:function __callFunction(module,method,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;Systrace.beginEvent(module+'.'+method+'()');if(this.__spy){this.__spy({type:TO_JS,module:module,method:method,args:args});}var moduleMethods=this.getCallableModule(module);invariant(!!moduleMethods,'Module %s is not a registered callable module (calling %s)',module,method);invariant(!!moduleMethods[method],'Method %s does not exist on module %s',method,module);var result=moduleMethods[method].apply(moduleMethods,args);Systrace.endEvent();return result;}},{key:'__invokeCallback',value:function __invokeCallback(cbID,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;var callID=cbID>>>1;var callback=cbID&1?this._successCallbacks[callID]:this._failureCallbacks[callID];if(__DEV__){var debug=this._debugInfo[callID];var _module=debug&&this._remoteModuleTable[debug[0]];var _method=debug&&this._remoteMethodTable[debug[0]][debug[1]];if(!callback){var errorMessage='Callback with id '+cbID+': '+_module+'.'+_method+'() not found';if(_method){errorMessage='The callback '+_method+'() exists in module '+_module+', '+'but only one callback may be registered to a function in a native module.';}invariant(callback,errorMessage);}var profileName=debug?'<callback for '+_module+'.'+_method+'>':cbID;if(callback&&this.__spy){this.__spy({type:TO_JS,module:null,method:profileName,args:args});}Systrace.beginEvent('MessageQueue.invokeCallback('+profileName+', '+stringifySafe(args)+')');}if(!callback){return;}this._successCallbacks[callID]=this._failureCallbacks[callID]=null;callback.apply(null,args);if(__DEV__){Systrace.endEvent();}}}],[{key:'spy',value:function spy(spyOrToggle){if(spyOrToggle===true){MessageQueue.prototype.__spy=function(info){console.log((info.type===TO_JS?'N->JS':'JS->N')+' : '+(''+(info.module?info.module+'.':'')+info.method)+('('+JSON.stringify(info.args)+')'));};}else if(spyOrToggle===false){MessageQueue.prototype.__spy=null;}else{MessageQueue.prototype.__spy=spyOrToggle;}}}]);return MessageQueue;}();module.exports=MessageQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VRdWV1ZS5qcyJdLCJuYW1lcyI6WyJFcnJvclV0aWxzIiwicmVxdWlyZSIsIlN5c3RyYWNlIiwiZGVlcEZyZWV6ZUFuZFRocm93T25NdXRhdGlvbkluRGV2IiwiaW52YXJpYW50Iiwic3RyaW5naWZ5U2FmZSIsIlRPX0pTIiwiVE9fTkFUSVZFIiwiTU9EVUxFX0lEUyIsIk1FVEhPRF9JRFMiLCJQQVJBTVMiLCJNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIkRFQlVHX0lORk9fTElNSVQiLCJKU1RpbWVycyIsIk1lc3NhZ2VRdWV1ZSIsIl9sYXp5Q2FsbGFibGVNb2R1bGVzIiwiX3F1ZXVlIiwiX3N1Y2Nlc3NDYWxsYmFja3MiLCJfZmFpbHVyZUNhbGxiYWNrcyIsIl9jYWxsSUQiLCJfbGFzdEZsdXNoIiwiX2V2ZW50TG9vcFN0YXJ0VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiX19ERVZfXyIsIl9kZWJ1Z0luZm8iLCJfcmVtb3RlTW9kdWxlVGFibGUiLCJfcmVtb3RlTWV0aG9kVGFibGUiLCJjYWxsRnVuY3Rpb25SZXR1cm5GbHVzaGVkUXVldWUiLCJiaW5kIiwiY2FsbEZ1bmN0aW9uUmV0dXJuUmVzdWx0QW5kRmx1c2hlZFF1ZXVlIiwiZmx1c2hlZFF1ZXVlIiwiaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUiLCJtb2R1bGUiLCJtZXRob2QiLCJhcmdzIiwiX19ndWFyZCIsIl9fY2FsbEZ1bmN0aW9uIiwicmVzdWx0IiwiY2JJRCIsIl9faW52b2tlQ2FsbGJhY2siLCJfX2NhbGxJbW1lZGlhdGVzIiwicXVldWUiLCJsZW5ndGgiLCJuYW1lIiwiZmFjdG9yeSIsImdldFZhbHVlIiwibW9kdWxlSUQiLCJtZXRob2RJRCIsInBhcmFtcyIsIm9uRmFpbCIsIm9uU3VjYyIsInB1c2giLCJnbG9iYWwiLCJuYXRpdmVUcmFjZUJlZ2luQXN5bmNGbG93IiwiSlNPTiIsInN0cmluZ2lmeSIsIm5vdyIsIm5hdGl2ZUZsdXNoUXVldWVJbW1lZGlhdGUiLCJfaW5DYWxsIiwiY291bnRlckV2ZW50IiwiX19zcHkiLCJpc0Zpbml0ZSIsInR5cGUiLCJtZXRob2RzIiwiZm4iLCJlcnJvciIsInJlcG9ydEZhdGFsRXJyb3IiLCJiZWdpbkV2ZW50IiwiY2FsbEltbWVkaWF0ZXMiLCJlbmRFdmVudCIsIm1vZHVsZU1ldGhvZHMiLCJnZXRDYWxsYWJsZU1vZHVsZSIsImFwcGx5IiwiY2FsbElEIiwiY2FsbGJhY2siLCJkZWJ1ZyIsImVycm9yTWVzc2FnZSIsInByb2ZpbGVOYW1lIiwic3B5T3JUb2dnbGUiLCJwcm90b3R5cGUiLCJjb25zb2xlIiwibG9nIiwiaW5mbyIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQWVBLGEsK29CQUVBLEdBQU1BLFlBQWFDLFFBQVEsWUFBUixDQUFuQixDQUNBLEdBQU1DLFVBQVdELFFBQVEsVUFBUixDQUFqQixDQUVBLEdBQU1FLG1DQUFvQ0YsUUFBUSxtQ0FBUixDQUExQyxDQUNBLEdBQU1HLFdBQVlILFFBQVEsb0JBQVIsQ0FBbEIsQ0FDQSxHQUFNSSxlQUFnQkosUUFBUSxlQUFSLENBQXRCLENBU0EsR0FBTUssT0FBUSxDQUFkLENBQ0EsR0FBTUMsV0FBWSxDQUFsQixDQUVBLEdBQU1DLFlBQWEsQ0FBbkIsQ0FDQSxHQUFNQyxZQUFhLENBQW5CLENBQ0EsR0FBTUMsUUFBUyxDQUFmLENBQ0EsR0FBTUMsNkJBQThCLENBQXBDLENBRUEsR0FBTUMsc0JBQXVCLEdBQUssRUFBbEMsQ0FFQSxHQUFNQyxrQkFBbUIsRUFBekIsQ0FHQSxHQUFJQyxVQUFXLElBQWYsQyxHQUVNQyxhLFlBZ0JKLHVCQUFjLG9DQUNaLEtBQUtDLG9CQUFMLENBQTRCLEVBQTVCLENBQ0EsS0FBS0MsTUFBTCxDQUFjLENBQUMsRUFBRCxDQUFLLEVBQUwsQ0FBUyxFQUFULENBQWEsQ0FBYixDQUFkLENBQ0EsS0FBS0MsaUJBQUwsQ0FBeUIsRUFBekIsQ0FDQSxLQUFLQyxpQkFBTCxDQUF5QixFQUF6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QUFLeEQsaUJBQUwsQ0FBdUJ3RCxNQUF2QixFQUFpQyxJQUFsRSxDQUNBQyxTQUFTRixLQUFULENBQWUsSUFBZixDQUFxQnRDLElBQXJCLEVBRUEsR0FBSVgsT0FBSixDQUFhLENBQ1h2QixTQUFTcUUsUUFBVCxHQUNELENBQ0YsQyxrQ0FsUVVTLFcsQ0FBa0QsQ0FDM0QsR0FBSUEsY0FBZ0IsSUFBcEIsQ0FBMEIsQ0FDeEJqRSxhQUFha0UsU0FBYixDQUF1Qm5CLEtBQXZCLENBQStCLGNBQVEsQ0FDckNvQixRQUFRQyxHQUFSLENBQ0UsQ0FBR0MsS0FBS3BCLElBQUwsR0FBYzFELEtBQWQsQ0FBc0IsT0FBdEIsQ0FBZ0MsT0FBbkMsYUFDSzhFLEtBQUtsRCxNQUFMLENBQWNrRCxLQUFLbEQsTUFBTCxDQUFjLEdBQTVCLENBQWtDLEVBRHZDLEVBQzRDa0QsS0FBS2pELE1BRGpELE9BRU1xQixLQUFLQyxTQUFMLENBQWUyQixLQUFLaEQsSUFBcEIsQ0FGTixLQURGLEVBS0QsQ0FORCxDQU9ELENBUkQsSUFRTyxJQUFJNEMsY0FBZ0IsS0FBcEIsQ0FBMkIsQ0FDaENqRSxhQUFha0UsU0FBYixDQUF1Qm5CLEtBQXZCLENBQStCLElBQS9CLENBQ0QsQ0FGTSxJQUVBLENBQ0wvQyxhQUFha0UsU0FBYixDQUF1Qm5CLEtBQXZCLENBQStCa0IsV0FBL0IsQ0FDRCxDQUNGLEMsNEJBdVBIOUMsT0FBT21ELE9BQVAsQ0FBaUJ0RSxZQUFqQiIsImZpbGUiOiJNZXNzYWdlUXVldWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIE1lc3NhZ2VRdWV1ZVxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4vKmVzbGludCBuby1iaXR3aXNlOiAwKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFcnJvclV0aWxzID0gcmVxdWlyZSgnRXJyb3JVdGlscycpO1xuY29uc3QgU3lzdHJhY2UgPSByZXF1aXJlKCdTeXN0cmFjZScpO1xuXG5jb25zdCBkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYgPSByZXF1aXJlKCdkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuY29uc3Qgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJ3N0cmluZ2lmeVNhZmUnKTtcblxuZXhwb3J0IHR5cGUgU3B5RGF0YSA9IHtcbiAgdHlwZTogbnVtYmVyLFxuICBtb2R1bGU6ID9zdHJpbmcsXG4gIG1ldGhvZDogc3RyaW5nIHwgbnVtYmVyLFxuICBhcmdzOiBhbnksXG59O1xuXG5jb25zdCBUT19KUyA9IDA7XG5jb25zdCBUT19OQVRJVkUgPSAxO1xuXG5jb25zdCBNT0RVTEVfSURTID0gMDtcbmNvbnN0IE1FVEhPRF9JRFMgPSAxO1xuY29uc3QgUEFSQU1TID0gMjtcbmNvbnN0IE1JTl9USU1FX0JFVFdFRU5fRkxVU0hFU19NUyA9IDU7XG5cbmNvbnN0IFRSQUNFX1RBR19SRUFDVF9BUFBTID0gMSA8PCAxNztcblxuY29uc3QgREVCVUdfSU5GT19MSU1JVCA9IDMyO1xuXG4vLyBXb3JrIGFyb3VuZCBhbiBpbml0aWFsaXphdGlvbiBvcmRlciBpc3N1ZVxubGV0IEpTVGltZXJzID0gbnVsbDtcblxuY2xhc3MgTWVzc2FnZVF1ZXVlIHtcbiAgX2xhenlDYWxsYWJsZU1vZHVsZXM6IHtba2V5OiBzdHJpbmddOiAodm9pZCkgPT4gT2JqZWN0fTtcbiAgX3F1ZXVlOiBbQXJyYXk8bnVtYmVyPiwgQXJyYXk8bnVtYmVyPiwgQXJyYXk8YW55PiwgbnVtYmVyXTtcbiAgX3N1Y2Nlc3NDYWxsYmFja3M6IEFycmF5PD9GdW5jdGlvbj47XG4gIF9mYWlsdXJlQ2FsbGJhY2tzOiBBcnJheTw/RnVuY3Rpb24+O1xuICBfY2FsbElEOiBudW1iZXI7XG4gIF9pbkNhbGw6IG51bWJlcjtcbiAgX2xhc3RGbHVzaDogbnVtYmVyO1xuICBfZXZlbnRMb29wU3RhcnRUaW1lOiBudW1iZXI7XG5cbiAgX2RlYnVnSW5mbzogT2JqZWN0O1xuICBfcmVtb3RlTW9kdWxlVGFibGU6IE9iamVjdDtcbiAgX3JlbW90ZU1ldGhvZFRhYmxlOiBPYmplY3Q7XG5cbiAgX19zcHk6ID8oZGF0YTogU3B5RGF0YSkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzID0ge307XG4gICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgMF07XG4gICAgdGhpcy5fc3VjY2Vzc0NhbGxiYWNrcyA9IFtdO1xuICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3MgPSBbXTtcbiAgICB0aGlzLl9jYWxsSUQgPSAwO1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IDA7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fZGVidWdJbmZvID0ge307XG4gICAgICB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZSA9IHt9O1xuICAgICAgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGUgPSB7fTtcbiAgICB9XG5cbiAgICAodGhpczogYW55KS5jYWxsRnVuY3Rpb25SZXR1cm5GbHVzaGVkUXVldWUgPSB0aGlzLmNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZS5iaW5kKFxuICAgICAgdGhpcyxcbiAgICApO1xuICAgICh0aGlzOiBhbnkpLmNhbGxGdW5jdGlvblJldHVyblJlc3VsdEFuZEZsdXNoZWRRdWV1ZSA9IHRoaXMuY2FsbEZ1bmN0aW9uUmV0dXJuUmVzdWx0QW5kRmx1c2hlZFF1ZXVlLmJpbmQoXG4gICAgICB0aGlzLFxuICAgICk7XG4gICAgKHRoaXM6IGFueSkuZmx1c2hlZFF1ZXVlID0gdGhpcy5mbHVzaGVkUXVldWUuYmluZCh0aGlzKTtcbiAgICAodGhpczogYW55KS5pbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZSA9IHRoaXMuaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUuYmluZChcbiAgICAgIHRoaXMsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgQVBJc1xuICAgKi9cblxuICBzdGF0aWMgc3B5KHNweU9yVG9nZ2xlOiBib29sZWFuIHwgKChkYXRhOiBTcHlEYXRhKSA9PiB2b2lkKSkge1xuICAgIGlmIChzcHlPclRvZ2dsZSA9PT0gdHJ1ZSkge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IGluZm8gPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgJHtpbmZvLnR5cGUgPT09IFRPX0pTID8gJ04tPkpTJyA6ICdKUy0+Tid9IDogYCArXG4gICAgICAgICAgICBgJHtpbmZvLm1vZHVsZSA/IGluZm8ubW9kdWxlICsgJy4nIDogJyd9JHtpbmZvLm1ldGhvZH1gICtcbiAgICAgICAgICAgIGAoJHtKU09OLnN0cmluZ2lmeShpbmZvLmFyZ3MpfSlgLFxuICAgICAgICApO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHNweU9yVG9nZ2xlID09PSBmYWxzZSkge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1lc3NhZ2VRdWV1ZS5wcm90b3R5cGUuX19zcHkgPSBzcHlPclRvZ2dsZTtcbiAgICB9XG4gIH1cblxuICBjYWxsRnVuY3Rpb25SZXR1cm5GbHVzaGVkUXVldWUoXG4gICAgbW9kdWxlOiBzdHJpbmcsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgYXJnczogQXJyYXk8YW55PixcbiAgKSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19jYWxsRnVuY3Rpb24obW9kdWxlLCBtZXRob2QsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZmx1c2hlZFF1ZXVlKCk7XG4gIH1cblxuICBjYWxsRnVuY3Rpb25SZXR1cm5SZXN1bHRBbmRGbHVzaGVkUXVldWUoXG4gICAgbW9kdWxlOiBzdHJpbmcsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgYXJnczogQXJyYXk8YW55PixcbiAgKSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgcmVzdWx0ID0gdGhpcy5fX2NhbGxGdW5jdGlvbihtb2R1bGUsIG1ldGhvZCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gW3Jlc3VsdCwgdGhpcy5mbHVzaGVkUXVldWUoKV07XG4gIH1cblxuICBpbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZShjYklEOiBudW1iZXIsIGFyZ3M6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2ludm9rZUNhbGxiYWNrKGNiSUQsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZmx1c2hlZFF1ZXVlKCk7XG4gIH1cblxuICBmbHVzaGVkUXVldWUoKSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19jYWxsSW1tZWRpYXRlcygpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcXVldWUgPSB0aGlzLl9xdWV1ZTtcbiAgICB0aGlzLl9xdWV1ZSA9IFtbXSwgW10sIFtdLCB0aGlzLl9jYWxsSURdO1xuICAgIHJldHVybiBxdWV1ZVswXS5sZW5ndGggPyBxdWV1ZSA6IG51bGw7XG4gIH1cblxuICBnZXRFdmVudExvb3BSdW5uaW5nVGltZSgpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLl9ldmVudExvb3BTdGFydFRpbWU7XG4gIH1cblxuICByZWdpc3RlckNhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZywgbW9kdWxlOiBPYmplY3QpIHtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdID0gKCkgPT4gbW9kdWxlO1xuICB9XG5cbiAgcmVnaXN0ZXJMYXp5Q2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nLCBmYWN0b3J5OiB2b2lkID0+IE9iamVjdCkge1xuICAgIGxldCBtb2R1bGU6IE9iamVjdDtcbiAgICBsZXQgZ2V0VmFsdWU6ID8odm9pZCkgPT4gT2JqZWN0ID0gZmFjdG9yeTtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdID0gKCkgPT4ge1xuICAgICAgaWYgKGdldFZhbHVlKSB7XG4gICAgICAgIG1vZHVsZSA9IGdldFZhbHVlKCk7XG4gICAgICAgIGdldFZhbHVlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtb2R1bGU7XG4gICAgfTtcbiAgfVxuXG4gIGdldENhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGdldFZhbHVlID0gdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlc1tuYW1lXTtcbiAgICByZXR1cm4gZ2V0VmFsdWUgPyBnZXRWYWx1ZSgpIDogbnVsbDtcbiAgfVxuXG4gIGVucXVldWVOYXRpdmVDYWxsKFxuICAgIG1vZHVsZUlEOiBudW1iZXIsXG4gICAgbWV0aG9kSUQ6IG51bWJlcixcbiAgICBwYXJhbXM6IEFycmF5PGFueT4sXG4gICAgb25GYWlsOiA/RnVuY3Rpb24sXG4gICAgb25TdWNjOiA/RnVuY3Rpb24sXG4gICkge1xuICAgIGlmIChvbkZhaWwgfHwgb25TdWNjKSB7XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEXSA9IFttb2R1bGVJRCwgbWV0aG9kSURdO1xuICAgICAgICBpZiAodGhpcy5fY2FsbElEID4gREVCVUdfSU5GT19MSU1JVCkge1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEIC0gREVCVUdfSU5GT19MSU1JVF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEVuY29kZSBjYWxsSURzIGludG8gcGFpcnMgb2YgY2FsbGJhY2sgaWRlbnRpZmllcnMgYnkgc2hpZnRpbmcgbGVmdCBhbmQgdXNpbmcgdGhlIHJpZ2h0bW9zdCBiaXRcbiAgICAgIC8vIHRvIGluZGljYXRlIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpXG4gICAgICBvbkZhaWwgJiYgcGFyYW1zLnB1c2godGhpcy5fY2FsbElEIDw8IDEpO1xuICAgICAgb25TdWNjICYmIHBhcmFtcy5wdXNoKCh0aGlzLl9jYWxsSUQgPDwgMSkgfCAxKTtcbiAgICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbdGhpcy5fY2FsbElEXSA9IG9uU3VjYztcbiAgICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbdGhpcy5fY2FsbElEXSA9IG9uRmFpbDtcbiAgICB9XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3cgJiZcbiAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3coXG4gICAgICAgICAgVFJBQ0VfVEFHX1JFQUNUX0FQUFMsXG4gICAgICAgICAgJ25hdGl2ZScsXG4gICAgICAgICAgdGhpcy5fY2FsbElELFxuICAgICAgICApO1xuICAgIH1cbiAgICB0aGlzLl9jYWxsSUQrKztcblxuICAgIHRoaXMuX3F1ZXVlW01PRFVMRV9JRFNdLnB1c2gobW9kdWxlSUQpO1xuICAgIHRoaXMuX3F1ZXVlW01FVEhPRF9JRFNdLnB1c2gobWV0aG9kSUQpO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIC8vIEFueSBwYXJhbXMgc2VudCBvdmVyIHRoZSBicmlkZ2Ugc2hvdWxkIGJlIGVuY29kYWJsZSBhcyBKU09OXG4gICAgICBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xuXG4gICAgICAvLyBUaGUgcGFyYW1zIG9iamVjdCBzaG91bGQgbm90IGJlIG11dGF0ZWQgYWZ0ZXIgYmVpbmcgcXVldWVkXG4gICAgICBkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYoKHBhcmFtczogYW55KSk7XG4gICAgfVxuICAgIHRoaXMuX3F1ZXVlW1BBUkFNU10ucHVzaChwYXJhbXMpO1xuXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgaWYgKFxuICAgICAgZ2xvYmFsLm5hdGl2ZUZsdXNoUXVldWVJbW1lZGlhdGUgJiZcbiAgICAgIChub3cgLSB0aGlzLl9sYXN0Rmx1c2ggPj0gTUlOX1RJTUVfQkVUV0VFTl9GTFVTSEVTX01TIHx8XG4gICAgICAgIHRoaXMuX2luQ2FsbCA9PT0gMClcbiAgICApIHtcbiAgICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgdGhpcy5fY2FsbElEXTtcbiAgICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5vdztcbiAgICAgIGdsb2JhbC5uYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlKHF1ZXVlKTtcbiAgICB9XG4gICAgU3lzdHJhY2UuY291bnRlckV2ZW50KCdwZW5kaW5nX2pzX3RvX25hdGl2ZV9xdWV1ZScsIHRoaXMuX3F1ZXVlWzBdLmxlbmd0aCk7XG4gICAgaWYgKF9fREVWX18gJiYgdGhpcy5fX3NweSAmJiBpc0Zpbml0ZShtb2R1bGVJRCkpIHtcbiAgICAgIHRoaXMuX19zcHkoe1xuICAgICAgICB0eXBlOiBUT19OQVRJVkUsXG4gICAgICAgIG1vZHVsZTogdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbbW9kdWxlSURdLFxuICAgICAgICBtZXRob2Q6IHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW21vZHVsZUlEXVttZXRob2RJRF0sXG4gICAgICAgIGFyZ3M6IHBhcmFtcyxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fX3NweSkge1xuICAgICAgdGhpcy5fX3NweSh7XG4gICAgICAgIHR5cGU6IFRPX05BVElWRSxcbiAgICAgICAgbW9kdWxlOiBtb2R1bGVJRCArICcnLFxuICAgICAgICBtZXRob2Q6IG1ldGhvZElELFxuICAgICAgICBhcmdzOiBwYXJhbXMsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVEZWJ1Z0xvb2t1cChtb2R1bGVJRDogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIG1ldGhvZHM6IEFycmF5PHN0cmluZz4pIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbbW9kdWxlSURdID0gbmFtZTtcbiAgICAgIHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW21vZHVsZUlEXSA9IG1ldGhvZHM7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgbWV0aG9kc1xuICAgKi9cblxuICBfX2d1YXJkKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5faW5DYWxsKys7XG4gICAgdHJ5IHtcbiAgICAgIGZuKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIEVycm9yVXRpbHMucmVwb3J0RmF0YWxFcnJvcihlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuX2luQ2FsbC0tO1xuICAgIH1cbiAgfVxuXG4gIF9fY2FsbEltbWVkaWF0ZXMoKSB7XG4gICAgU3lzdHJhY2UuYmVnaW5FdmVudCgnSlNUaW1lcnMuY2FsbEltbWVkaWF0ZXMoKScpO1xuICAgIGlmICghSlNUaW1lcnMpIHtcbiAgICAgIEpTVGltZXJzID0gcmVxdWlyZSgnSlNUaW1lcnMnKTtcbiAgICB9XG4gICAgSlNUaW1lcnMuY2FsbEltbWVkaWF0ZXMoKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICB9XG5cbiAgX19jYWxsRnVuY3Rpb24obW9kdWxlOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBhcmdzOiBBcnJheTxhbnk+KSB7XG4gICAgdGhpcy5fbGFzdEZsdXNoID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gdGhpcy5fbGFzdEZsdXNoO1xuICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoYCR7bW9kdWxlfS4ke21ldGhvZH0oKWApO1xuICAgIGlmICh0aGlzLl9fc3B5KSB7XG4gICAgICB0aGlzLl9fc3B5KHt0eXBlOiBUT19KUywgbW9kdWxlLCBtZXRob2QsIGFyZ3N9KTtcbiAgICB9XG4gICAgY29uc3QgbW9kdWxlTWV0aG9kcyA9IHRoaXMuZ2V0Q2FsbGFibGVNb2R1bGUobW9kdWxlKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHMsXG4gICAgICAnTW9kdWxlICVzIGlzIG5vdCBhIHJlZ2lzdGVyZWQgY2FsbGFibGUgbW9kdWxlIChjYWxsaW5nICVzKScsXG4gICAgICBtb2R1bGUsXG4gICAgICBtZXRob2QsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHNbbWV0aG9kXSxcbiAgICAgICdNZXRob2QgJXMgZG9lcyBub3QgZXhpc3Qgb24gbW9kdWxlICVzJyxcbiAgICAgIG1ldGhvZCxcbiAgICAgIG1vZHVsZSxcbiAgICApO1xuICAgIGNvbnN0IHJlc3VsdCA9IG1vZHVsZU1ldGhvZHNbbWV0aG9kXS5hcHBseShtb2R1bGVNZXRob2RzLCBhcmdzKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBfX2ludm9rZUNhbGxiYWNrKGNiSUQ6IG51bWJlciwgYXJnczogQXJyYXk8YW55Pikge1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZSA9IHRoaXMuX2xhc3RGbHVzaDtcblxuICAgIC8vIFRoZSByaWdodG1vc3QgYml0IG9mIGNiSUQgaW5kaWNhdGVzIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpLCB0aGUgb3RoZXIgYml0cyBhcmUgdGhlIGNhbGxJRCBzaGlmdGVkIGxlZnQuXG4gICAgY29uc3QgY2FsbElEID0gY2JJRCA+Pj4gMTtcbiAgICBjb25zdCBjYWxsYmFjayA9XG4gICAgICBjYklEICYgMVxuICAgICAgICA/IHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbY2FsbElEXVxuICAgICAgICA6IHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbY2FsbElEXTtcblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBjb25zdCBkZWJ1ZyA9IHRoaXMuX2RlYnVnSW5mb1tjYWxsSURdO1xuICAgICAgY29uc3QgbW9kdWxlID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbZGVidWdbMF1dO1xuICAgICAgY29uc3QgbWV0aG9kID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGVbZGVidWdbMF1dW2RlYnVnWzFdXTtcbiAgICAgIGlmICghY2FsbGJhY2spIHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IGBDYWxsYmFjayB3aXRoIGlkICR7Y2JJRH06ICR7bW9kdWxlfS4ke21ldGhvZH0oKSBub3QgZm91bmRgO1xuICAgICAgICBpZiAobWV0aG9kKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICAgIGBUaGUgY2FsbGJhY2sgJHttZXRob2R9KCkgZXhpc3RzIGluIG1vZHVsZSAke21vZHVsZX0sIGAgK1xuICAgICAgICAgICAgJ2J1dCBvbmx5IG9uZSBjYWxsYmFjayBtYXkgYmUgcmVnaXN0ZXJlZCB0byBhIGZ1bmN0aW9uIGluIGEgbmF0aXZlIG1vZHVsZS4nO1xuICAgICAgICB9XG4gICAgICAgIGludmFyaWFudChjYWxsYmFjaywgZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHByb2ZpbGVOYW1lID0gZGVidWdcbiAgICAgICAgPyAnPGNhbGxiYWNrIGZvciAnICsgbW9kdWxlICsgJy4nICsgbWV0aG9kICsgJz4nXG4gICAgICAgIDogY2JJRDtcbiAgICAgIGlmIChjYWxsYmFjayAmJiB0aGlzLl9fc3B5KSB7XG4gICAgICAgIHRoaXMuX19zcHkoe3R5cGU6IFRPX0pTLCBtb2R1bGU6IG51bGwsIG1ldGhvZDogcHJvZmlsZU5hbWUsIGFyZ3N9KTtcbiAgICAgIH1cbiAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoXG4gICAgICAgIGBNZXNzYWdlUXVldWUuaW52b2tlQ2FsbGJhY2soJHtwcm9maWxlTmFtZX0sICR7c3RyaW5naWZ5U2FmZShhcmdzKX0pYCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCFjYWxsYmFjaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbY2FsbElEXSA9IHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbY2FsbElEXSA9IG51bGw7XG4gICAgY2FsbGJhY2suYXBwbHkobnVsbCwgYXJncyk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBNZXNzYWdlUXVldWU7XG4iXX0=